
from fastapi import FastAPI, Request
from fastapi.responses import JSONResponse
from aiogram import Bot, Dispatcher, types
from aiogram.types import ReplyKeyboardMarkup, KeyboardButton
from aiogram.utils.executor import start_webhook
import asyncio
import os

API_TOKEN = os.getenv("BOT_TOKEN")

app = FastAPI()
bot = Bot(token=API_TOKEN)
dp = Dispatcher(bot)

# –û–±–Ω–æ–≤–ª—ë–Ω–Ω–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞
static_keyboard = ReplyKeyboardMarkup(
    keyboard=[
        [KeyboardButton(text="üîÑ –†–µ—Å—Ç–∞—Ä—Ç")],
        [KeyboardButton(text="üíº –†–∞–±–æ—Ç–∞"), KeyboardButton(text="üéì –£—á—ë–±–∞")],
        [KeyboardButton(text="üìà –ë–∏–∑–Ω–µ—Å"), KeyboardButton(text="üì£ –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥")],
        [KeyboardButton(text="üß© Help"), KeyboardButton(text="‚ÑπÔ∏è –û –ø—Ä–æ–µ–∫—Ç–µ")]
    ],
    resize_keyboard=True,
    one_time_keyboard=False
)

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
@app.post("/")
async def receive_update(request: Request):
    data = await request.json()
    message = data.get("message", {})
    chat_id = message.get("chat", {}).get("id")
    text = message.get("text")

    if not chat_id or not text:
        return JSONResponse(content={"ok": True})

    if text == "/start":
        welcome_text = (
            "üëã –ü—Ä–∏–≤–µ—Ç! –Ø ‚Äî —Ç–≤–æ–π AI-–ø–æ–º–æ—â–Ω–∏–∫ ASKT
"
            "(–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –¢–≤–æ–∏—Ö –∑–∞–¥–∞—á).

"
            "–ü–æ–º–æ–≥–∞—é —Ä–µ—à–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã ‚Äî –±—ã—Å—Ç—Ä–æ –∏ –ø–æ –¥–µ–ª—É.
"
            "–ë–µ–∑ –ø—Ä–æ–º—Ç–æ–≤, –±–µ–∑ –ª–∏—à–Ω–µ–≥–æ —Ç–µ–∫—Å—Ç–∞.

"
            "–í—ã–±–∏—Ä–∞–π —Å—Ñ–µ—Ä—É, –æ—Ç–≤–µ—á–∞–π –Ω–∞ 3 –≤–æ–ø—Ä–æ—Å–∞ ‚Äî
"
            "–∏ —Å—Ä–∞–∑—É –ø–æ–ª—É—á–∞–µ—à—å —Ç–æ—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

"
            "‚Ñπ –ö–∞–∫ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Äî –∫–Ω–æ–ø–∫–∞ Help
"
            "üìé –ö—Ç–æ —è –∏ –∑–∞—á–µ–º ‚Äî –∫–Ω–æ–ø–∫–∞ –û –ø—Ä–æ–µ–∫—Ç–µ

"
            "üöÄ –ì–æ—Ç–æ–≤? –ü–æ–µ—Ö–∞–ª–∏:"
        )
        await bot.send_message(chat_id=chat_id, text=welcome_text, reply_markup=static_keyboard)
        return JSONResponse(content={"ok": True})

    if text == "üß© Help":
        help_text = (
            "‚ÑπÔ∏è –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç ASKT:

"
            "1. –¢—ã –≤—ã–±–∏—Ä–∞–µ—à—å —Å—Ñ–µ—Ä—É –∑–∞–¥–∞—á–∏: —Ä–∞–±–æ—Ç–∞, —É—á—ë–±–∞, –±–∏–∑–Ω–µ—Å –∏–ª–∏ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥.
"
            "2. –û—Ç–≤–µ—á–∞–µ—à—å –Ω–∞ 3 –≤–æ–ø—Ä–æ—Å–∞: –∫—Ç–æ —Ç—ã, —á—Ç–æ –Ω—É–∂–Ω–æ —Ä–µ—à–∏—Ç—å, –∫–∞–∫–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ö–æ—á–µ—à—å.
"
            "3. –Ø —Å–æ–±–∏—Ä–∞—é –ø—Ä–æ–º—Ç –∏ –ø–µ—Ä–µ–¥–∞—é –µ–≥–æ –≤ GPT-3.5-turbo ‚Äî –Ω–µ–π—Ä–æ—Å–µ—Ç—å, –æ–±—É—á–µ–Ω–Ω—É—é —Ä–µ—à–∞—Ç—å –∑–∞–¥–∞—á–∏ –ø–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É.

"
            "‚öôÔ∏è –ß—Ç–æ —è –¥–µ–ª–∞—é:
"
            "‚Äî –§–æ—Ä–º—É–ª–∏—Ä—É—é –ø–æ–Ω—è—Ç–Ω—ã–π –∏ —Ç–æ—á–Ω—ã–π –æ—Ç–≤–µ—Ç
"
            "‚Äî –ü–æ–º–æ–≥–∞—é —Å –∏–¥–µ—è–º–∏, –ø–ª–∞–Ω–∞–º–∏, —Ç–µ–∫—Å—Ç–∞–º–∏
"
            "‚Äî –£–ø—Ä–æ—â–∞—é —Å–ª–æ–∂–Ω—ã–µ –∑–∞–¥–∞—á–∏ –∏ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏

"
            "‚ùå –ß—Ç–æ —è –Ω–µ –¥–µ–ª–∞—é:
"
            "‚Äî –ù–µ –∏—â—É –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ
"
            "‚Äî –ù–µ —Ä–∞–±–æ—Ç–∞—é —Å —Ñ–∞–π–ª–∞–º–∏ (–ø–æ–∫–∞)
"
            "‚Äî –ù–µ –ø–∏—à—É –∫–æ–¥, –≥—Ä–∞—Ñ–∏–∫–∏, —Ç–∞–±–ª–∏—Ü—ã

"
            "‚úâ –ü—Ä–∏–º–µ—Ä:
"
            "> –Ø —Å—Ç—É–¥–µ–Ω—Ç. –•–æ—á—É –ø–æ–ª—É—á–∏—Ç—å —Å—Ö–µ–º—É –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ —ç–∫–∑–∞–º–µ–Ω—É –ø–æ –ø—Ä–∞–≤—É.

"
            "–†–µ–∑—É–ª—å—Ç–∞—Ç: —á—ë—Ç–∫–∏–π –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π —Å —Ä–∞–∑–±–∏–≤–∫–æ–π –ø–æ –¥–Ω—è–º.

"
            "üõ† –ì–æ—Ç–æ–≤ –∫ –∑–∞–ø—É—Å–∫—É? –ñ–º–∏ ¬´–†–µ—Å—Ç–∞—Ä—Ç¬ª

"
            "üìé –•–æ—á–µ—à—å –±–æ–ª—å—à–µ?
"
            "‚Äî –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ ChatGPT —Å GPT-4
"
            "‚Äî –¢–∞–±–ª–∏—Ü—ã, —Ñ–∞–π–ª—ã, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
"
            "‚Äî –ù–∞—Å—Ç—Ä–æ–π–∫–∞ GPT –ø–æ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∑–∞–¥–∞—á–∏
"
            "‚Äî –°–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ –∏ –ø–æ–¥–±–æ—Ä —Ä–∞–±–æ—á–∏—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

"
            "–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—é:
"
            "‚Äî –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π VPN
"
            "‚Äî –£–¥–æ–±–Ω—ã–π —Å–µ—Ä–≤–∏—Å –¥–ª—è –æ–ø–ª–∞—Ç—ã –ø–æ–¥–ø–∏—Å–æ–∫
"
            "‚Äî –ü–æ–º–æ—â—å —Å —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π

"
            "–°–≤—è–∑—å üëâ @veryhappyEpta"
        )
        await bot.send_message(chat_id=chat_id, text=help_text, reply_markup=static_keyboard)
        return JSONResponse(content={"ok": True})

    if text == "‚ÑπÔ∏è –û –ø—Ä–æ–µ–∫—Ç–µ":
        await bot.send_message(chat_id=chat_id, text="AS–ûKT ‚Äî —ç—Ç–æ –±–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç —Ç–≤–æ—é –∑–∞–¥–∞—á—É –≤ —Ç–æ—á–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∫ –ò–ò. –û–Ω –Ω–µ –ø—Ä–æ—Å—Ç–æ –æ—Ç–≤–µ—á–∞–µ—Ç, –∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∑–∞ —Ç–µ–±—è: —Ñ–æ—Ä–º—É–ª–∏—Ä—É–µ—Ç, —É—Ç–æ—á–Ω—è–µ—Ç, –≤—ã–¥–∞—ë—Ç –≥–æ—Ç–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ. –°–¥–µ–ª–∞–Ω –¥–ª—è —Ç–µ—Ö, –∫—Ç–æ –Ω–µ —Ö–æ—á–µ—Ç —Ç—Ä–∞—Ç–∏—Ç—å –≤—Ä–µ–º—è –Ω–∞ –ø—Ä–æ–º—Ç—ã –∏ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è.", reply_markup=static_keyboard)
        return JSONResponse(content={"ok": True})

    await bot.send_message(chat_id=chat_id, text="–í—ã–±–µ—Ä–∏ –æ–¥–Ω—É –∏–∑ –æ–ø—Ü–∏–π –Ω–∏–∂–µ üëá", reply_markup=static_keyboard)
    return JSONResponse(content={"ok": True})

# Webhook (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
WEBHOOK_PATH = "/"
WEBHOOK_URL = "https://your-railway-app-url.com"  # –ó–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–π –¥–æ–º–µ–Ω Railway

async def on_startup(dispatcher):
    await bot.set_webhook(WEBHOOK_URL + WEBHOOK_PATH)

async def on_shutdown(dispatcher):
    await bot.delete_webhook()

if __name__ == "__main__":
    from aiogram import executor
    executor.start_polling(dp, skip_updates=True)
